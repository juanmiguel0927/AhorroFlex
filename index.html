<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahorro Flex - Plan de Ahorro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }

        /* --- ESTILOS DE IMPRESIÓN CORREGIDOS --- */
        @media print {
            /* 1. Configuración de la página para quitar encabezados/pies de página */
            @page {
                margin: 0; /* Esto elimina fecha, título y URL */
                size: auto;
            }

            /* 2. Ocultar TODO por defecto */
            body * {
                visibility: hidden;
            }

            /* 3. Resetear el cuerpo para evitar bloqueos */
            body, html {
                background-color: white !important;
                height: auto !important;
                overflow: visible !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 4. Mostrar SOLO el área imprimible */
            .printable-area, .printable-area * {
                visibility: visible !important;
            }

            /* 5. Posicionar el área imprimible sobre todo lo demás */
            .printable-area {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 1.5cm !important; /* Margen interno estético */
                background: white !important;
                color: black !important;
                display: block !important;
                z-index: 9999 !important;
            }

            /* 6. Estilos específicos de la tabla impresa */
            .no-print { display: none !important; }
            
            .print-grid { 
                display: grid; 
                grid-template-columns: repeat(5, 1fr); 
                gap: 8px; 
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            }
            
            .print-item { 
                border: 1px solid #000; 
                padding: 6px 2px; 
                text-align: center; 
                border-radius: 4px; 
                font-size: 11px;
                page-break-inside: avoid; /* Evitar que se partan casillas entre hojas */
            }
            
            .print-header { 
                text-align: center; 
                margin-bottom: 20px; 
                font-family: sans-serif;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
            }
            
            .print-header h1 { font-size: 24px; font-weight: bold; margin: 0; }
            .print-header p { font-size: 14px; margin: 5px 0 0 0; }

            .print-item.paid { 
                background-color: #e5e5e5 !important; 
                text-decoration: line-through; 
                -webkit-print-color-adjust: exact; /* Para que salga el gris en Chrome */
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { createRoot } = ReactDOM;

        // Iconos
        const Icon = ({ path, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>;
        const PiggyBank = (p) => <Icon {...p} path={<><path d="M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2.5 0-.8.3-2.4-.6-6-.5-.6-1.5-2.5-4.4-2.5z"/><path d="M16 9h.01"/><path d="M7 16h-.01"/></>} />;
        const ArrowUpDown = (p) => <Icon {...p} path={<><path d="m21 16-4 4-4-4"/><path d="M17 20V4"/><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/></>} />;
        const CheckCircle2 = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} />;
        const Search = (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />;
        const Moon = (p) => <Icon {...p} path={<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>} />;
        const Sun = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>} />;
        const Download = (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />;
        const Upload = (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />;
        const TrendingUp = (p) => <Icon {...p} path={<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>} />;
        const TrendingDown = (p) => <Icon {...p} path={<polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>} />;
        const X = (p) => <Icon {...p} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />;
        const Hash = (p) => <Icon {...p} path={<><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></>} />;
        const Printer = (p) => <Icon {...p} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />;
        const HelpCircle = (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></>} />;
        const Trash2 = (p) => <Icon {...p} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />;
        const Pencil = (p) => <Icon {...p} path={<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>} />;
        const AlertTriangle = (p) => <Icon {...p} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></>} />;

        // Utils
        const EXCHANGE_RATES = { COP: 1, USD: 4100, EUR: 4450 };
        const DEFAULT_MOMENTS = 365;

        const formatMoney = (amount, currency = 'COP') => {
            const value = amount / EXCHANGE_RATES[currency];
            return new Intl.NumberFormat(currency === 'COP' ? 'es-CO' : 'en-US', {
                style: 'currency', currency, minimumFractionDigits: 0, maximumFractionDigits: 0
            }).format(value);
        };

        const roundTo100 = (n) => Math.round(n / 100) * 100;

        const generateDataForTarget = (targetAmount, totalMoments) => {
            const safeTarget = roundTo100(targetAmount || 0);
            const safeMoments = totalMoments || 1;
            if (safeTarget <= 0) return [];
            const average = safeTarget / safeMoments;
            let minVal = Math.max(100, roundTo100(average * 0.05));
            let maxVal = roundTo100(average * 1.95);
            if (average < 200) { minVal = 100; maxVal = 300; }
            let amounts = [];
            for (let i = 0; i < safeMoments; i++) {
                let val = (minVal >= maxVal) ? minVal : Math.floor(Math.random() * ((maxVal - minVal) / 100 + 1)) * 100 + minVal;
                amounts.push(val);
            }
            let diff = safeTarget - amounts.reduce((a, b) => a + b, 0);
            let safety = 0;
            const maxLoops = safeMoments * 500;
            while (diff !== 0 && safety < maxLoops) {
                const idx = Math.floor(Math.random() * safeMoments);
                const step = 100; 
                if (diff > 0) {
                    if (amounts[idx] + step <= maxVal * 1.5 || average < 200) { amounts[idx] += step; diff -= step; }
                } else {
                    if (amounts[idx] - step >= minVal) { amounts[idx] -= step; diff += step; }
                }
                safety++;
            }
            if (diff !== 0) {
                const maxAmountIdx = amounts.indexOf(Math.max(...amounts));
                if (maxAmountIdx !== -1) amounts[maxAmountIdx] += diff;
            }
            return amounts.map(a => ({ amount: a, paid: false, datePaid: null })).sort(() => Math.random() - 0.5).map((item, index) => ({ ...item, id: index + 1 }));
        };

        function App() {
            const [targetAmount, setTargetAmount] = useState(0);
            const [totalMoments, setTotalMoments] = useState(DEFAULT_MOMENTS);
            const [savings, setSavings] = useState([]);
            const [isConfigured, setIsConfigured] = useState(false);
            const [amountInput, setAmountInput] = useState('');
            const [momentsInput, setMomentsInput] = useState('365');
            const [darkMode, setDarkMode] = useState(false);
            const [showHelp, setShowHelp] = useState(false);
            const [filter, setFilter] = useState('all');
            const [sortOrder, setSortOrder] = useState('default');
            const [searchTerm, setSearchTerm] = useState('');
            const [currency, setCurrency] = useState('COP');
            const fileInputRef = useRef(null);

            useEffect(() => {
                try {
                    const savedConfig = localStorage.getItem('savings_v5_config');
                    const savedData = localStorage.getItem('savings_v5_data');
                    const savedTheme = localStorage.getItem('savings_v5_theme');
                    if (savedConfig && savedData) {
                        const parsedConfig = JSON.parse(savedConfig);
                        const parsedData = JSON.parse(savedData);
                        if (parsedConfig?.target && Array.isArray(parsedData)) {
                            setTargetAmount(parsedConfig.target);
                            setTotalMoments(parsedConfig.moments || DEFAULT_MOMENTS);
                            setAmountInput(new Intl.NumberFormat('es-CO').format(parsedConfig.target));
                            setMomentsInput(parsedConfig.moments || DEFAULT_MOMENTS);
                            setSavings(parsedData);
                            setIsConfigured(true);
                        }
                    }
                    if (savedTheme === 'dark') setDarkMode(true);
                } catch (e) {}
            }, []);

            useEffect(() => {
                try {
                    if (isConfigured && targetAmount > 0) {
                        localStorage.setItem('savings_v5_config', JSON.stringify({ target: targetAmount, moments: totalMoments }));
                        localStorage.setItem('savings_v5_data', JSON.stringify(savings));
                    }
                    localStorage.setItem('savings_v5_theme', darkMode ? 'dark' : 'light');
                    if (darkMode) { document.documentElement.classList.add('dark'); } else { document.documentElement.classList.remove('dark'); }
                } catch (e) {}
            }, [savings, targetAmount, totalMoments, isConfigured, darkMode]);

            const handleStart = (e) => {
                e.preventDefault();
                let amount = parseInt(String(amountInput).replace(/[^0-9]/g, ''), 10);
                let moments = parseInt(momentsInput, 10);
                if (!amount || amount < (moments * 100)) return alert(`Mínimo $100 por casilla.`);
                if (!moments || moments < 1 || moments > 5000) return alert("Momentos entre 1 y 5000.");
                amount = roundTo100(amount);
                if (isConfigured && !window.confirm("Se generará una NUEVA tabla. ¿Continuar?")) return;
                setTargetAmount(amount);
                setTotalMoments(moments);
                setSavings(generateDataForTarget(amount, moments));
                setIsConfigured(true);
            };

            const togglePay = (id) => {
                setSavings(prev => prev.map(item => item.id === id ? { ...item, paid: !item.paid, datePaid: !item.paid ? new Date().toISOString() : null } : item));
            };

            const handlePrint = () => window.print();

            const exportData = () => {
                const blob = new Blob([JSON.stringify({ config: { target: targetAmount, moments: totalMoments }, data: savings }, null, 2)], { type: "application/json" });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `ahorro_flex_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const json = JSON.parse(ev.target.result);
                        if (json.config && json.data && window.confirm("Se reemplazarán los datos. ¿Continuar?")) {
                            setTargetAmount(json.config.target);
                            setTotalMoments(json.config.moments || DEFAULT_MOMENTS);
                            setAmountInput(new Intl.NumberFormat('es-CO').format(json.config.target));
                            setMomentsInput(json.config.moments || DEFAULT_MOMENTS);
                            setSavings(json.data);
                            setIsConfigured(true);
                        }
                    } catch (err) { alert("Archivo inválido"); }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const totalPaid = useMemo(() => savings.reduce((acc, curr) => curr.paid ? acc + curr.amount : acc, 0), [savings]);
            const percent = targetAmount > 0 ? (totalPaid / targetAmount) * 100 : 0;
            const stats = useMemo(() => {
                if (!savings.length) return { min: 0, max: 0 };
                const amounts = savings.map(s => s.amount);
                return { min: Math.min(...amounts), max: Math.max(...amounts) };
            }, [savings]);

            const displayedSavings = useMemo(() => {
                let res = [...savings];
                if (searchTerm) res = res.filter(i => i.amount.toString().includes(searchTerm));
                if (filter === 'pending') res = res.filter(i => !i.paid);
                if (filter === 'paid') res = res.filter(i => i.paid);
                if (sortOrder === 'asc') res.sort((a, b) => a.amount - b.amount);
                else if (sortOrder === 'desc') res.sort((a, b) => b.amount - a.amount);
                else res.sort((a, b) => a.id - b.id);
                return res;
            }, [savings, filter, sortOrder, searchTerm]);

            if (!isConfigured) {
                return (
                    <div className={`min-h-screen flex items-center justify-center p-4 font-sans ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-800'}`}>
                        <div className={`relative p-8 rounded-3xl shadow-2xl max-w-md w-full border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-indigo-100'}`}>
                            <button onClick={() => setDarkMode(!darkMode)} className="absolute top-4 right-4 p-2 rounded-full opacity-60 hover:opacity-100">{darkMode ? <Sun size={20}/> : <Moon size={20}/>}</button>
                            <div className="flex justify-center mb-6"><div className={`p-5 rounded-full shadow-lg ${darkMode ? 'bg-indigo-900/50' : 'bg-indigo-100'}`}><PiggyBank className="w-12 h-12 text-indigo-600" /></div></div>
                            <h1 className="text-3xl font-black text-center mb-2">Plan de Ahorro</h1>
                            <p className="text-center mb-8 text-sm opacity-60">Configura tu meta.</p>
                            <form onSubmit={handleStart} className="space-y-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider mb-2 opacity-60 ml-1">Monto Total</label>
                                    <div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 font-bold text-lg opacity-50">$</span><input type="text" required value={amountInput} onChange={(e) => setAmountInput(new Intl.NumberFormat('es-CO').format(e.target.value.replace(/[^0-9]/g, '')))} placeholder="Ej: 5.000.000" className={`w-full pl-10 pr-4 py-3 border rounded-xl font-bold text-xl focus:outline-none focus:ring-2 transition-all ${darkMode ? 'bg-slate-900 border-slate-600' : 'bg-slate-50 border-slate-200'}`} /></div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider mb-2 opacity-60 ml-1">Pasos (Días)</label>
                                    <div className="relative"><Hash className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 opacity-50" /><input type="number" required min="1" max="5000" value={momentsInput} onChange={(e) => setMomentsInput(e.target.value)} placeholder="365" className={`w-full pl-10 pr-4 py-3 border rounded-xl font-bold text-xl focus:outline-none focus:ring-2 transition-all ${darkMode ? 'bg-slate-900 border-slate-600' : 'bg-slate-50 border-slate-200'}`} /></div>
                                </div>
                                {savings.length > 0 && <div className="flex items-center gap-2 text-xs text-yellow-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200"><AlertTriangle className="w-4 h-4 shrink-0" /><span>Se reiniciará el progreso.</span></div>}
                                <div className="flex gap-3 pt-4"><button type="submit" className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition-transform active:scale-95">{savings.length > 0 ? 'Actualizar' : 'Crear'}</button><button type="button" onClick={() => fileInputRef.current.click()} className="px-4 rounded-xl border flex items-center justify-center hover:bg-opacity-10 hover:bg-black"><Upload className="w-6 h-6 opacity-60" /></button></div>
                            </form>
                            <input type="file" ref={fileInputRef} onChange={importData} accept=".json" className="hidden" />
                            <div className="mt-8 text-center text-[10px] opacity-40">Desarrollado por <strong>Juan Miguel Rios Redondo</strong></div>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen font-sans pb-24 ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-800'}`}>
                    
                    {/* HELP MODAL */}
                    {showHelp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in">
                            <div className={`relative max-w-lg w-full p-6 rounded-2xl shadow-2xl ${darkMode ? 'bg-slate-800 border border-slate-700' : 'bg-white'}`}>
                                <button onClick={() => setShowHelp(false)} className="absolute top-4 right-4 opacity-50 hover:opacity-100"><X className="w-6 h-6" /></button>
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><HelpCircle className="w-6 h-6 text-indigo-500" /> Ayuda</h2>
                                <div className="space-y-4 text-sm opacity-80">
                                    <p>Tu meta de <strong>{formatMoney(targetAmount)}</strong> se divide en <strong>{totalMoments} pasos</strong>.</p>
                                    <div className={`p-4 rounded-xl border ${darkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-100 border-slate-200'}`}>
                                        <p className="font-bold mb-2">Rangos:</p>
                                        <ul className="list-disc list-inside"><li>Mínimo: {formatMoney(stats.min)}</li><li>Máximo: {formatMoney(stats.max)}</li></ul>
                                    </div>
                                    <p>Elige una casilla, ahorra ese dinero y márcala.</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* PRINT AREA */}
                    <div className="printable-area hidden">
                        <div className="print-header">
                            <h1>Plan de Ahorro: {formatMoney(targetAmount)}</h1>
                            <p>Meta: {totalMoments} pasos | Min: {formatMoney(stats.min)} | Max: {formatMoney(stats.max)}</p>
                        </div>
                        <div className="print-grid">
                            {savings.map(s => (
                                <div key={s.id} className={`print-item ${s.paid ? 'paid' : ''}`}>
                                    #{s.id}<br/><strong>{formatMoney(s.amount)}</strong>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* MAIN UI */}
                    <div className="no-print">
                        <div className={`sticky top-0 z-30 backdrop-blur-md border-b transition-colors ${darkMode ? 'bg-slate-900/90 border-slate-800' : 'bg-white/90 border-slate-200'}`}>
                            <div className="max-w-7xl mx-auto px-4 py-3">
                                <div className="flex flex-wrap justify-between items-center mb-4 gap-3">
                                    <h1 className="text-lg font-bold flex items-center gap-2">
                                        <div className={`p-1.5 rounded-lg ${darkMode ? 'bg-indigo-900/50' : 'bg-indigo-50'}`}><PiggyBank className="w-5 h-5 text-indigo-500" /></div>
                                        <span>Ahorro Flex</span>
                                    </h1>
                                    <div className="flex items-center gap-1 p-1 rounded-xl border border-gray-200 dark:border-gray-700">
                                        <button onClick={() => setIsConfigured(false)} className="p-2 opacity-60 hover:opacity-100 hover:text-indigo-500"><Pencil size={16} /></button>
                                        <button onClick={() => { if(window.confirm("¿Borrar todo?")) { setIsConfigured(false); setTargetAmount(0); setSavings([]); localStorage.removeItem('savings_v5_config'); localStorage.removeItem('savings_v5_data'); } }} className="p-2 opacity-60 hover:opacity-100 hover:text-red-500"><Trash2 size={16} /></button>
                                        <div className="w-px h-4 bg-current opacity-20"></div>
                                        <button onClick={() => setShowHelp(true)} className="p-2 opacity-60 hover:opacity-100"><HelpCircle size={16} /></button>
                                        <button onClick={handlePrint} className="p-2 opacity-60 hover:opacity-100"><Printer size={16} /></button>
                                        <button onClick={exportData} className="p-2 opacity-60 hover:opacity-100"><Download size={16} /></button>
                                        <button onClick={() => setDarkMode(!darkMode)} className="p-2 opacity-60 hover:opacity-100">{darkMode ? <Sun size={16} /> : <Moon size={16} />}</button>
                                    </div>
                                </div>
                                <div className={`rounded-2xl p-5 border mb-4 shadow-sm relative overflow-hidden ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>
                                    <div className="relative z-10 flex justify-between items-end mb-2">
                                        <div>
                                            <p className="text-[10px] opacity-50 uppercase font-bold tracking-wider mb-1">Ahorrado</p>
                                            <div className="flex items-baseline gap-2"><p className="text-2xl font-black">{formatMoney(totalPaid, currency)}</p><span className="text-xs opacity-50">/ {formatMoney(targetAmount, currency)}</span></div>
                                        </div>
                                        <p className="text-indigo-500 font-bold text-xl">{percent.toFixed(1)}%</p>
                                    </div>
                                    <div className={`w-full rounded-full h-2.5 overflow-hidden mb-3 ${darkMode ? 'bg-slate-900' : 'bg-slate-100'}`}><div className="bg-gradient-to-r from-pink-500 to-indigo-600 h-2.5 rounded-full transition-all duration-700" style={{ width: `${percent}%` }}></div></div>
                                    <div className="flex gap-4 text-xs pt-2 border-t border-dashed border-gray-500/20">
                                        <div className="flex items-center gap-1 opacity-70"><TrendingDown className="w-3 h-3 text-green-500"/> Min: <b>{formatMoney(stats.min, currency)}</b></div>
                                        <div className="flex items-center gap-1 opacity-70"><TrendingUp className="w-3 h-3 text-red-500"/> Max: <b>{formatMoney(stats.max, currency)}</b></div>
                                    </div>
                                </div>
                                <div className="flex flex-col sm:flex-row gap-3">
                                    <div className="relative flex-grow"><span className="absolute left-3 top-1/2 -translate-y-1/2 opacity-30"><Search size={16}/></span><input type="number" placeholder="Buscar..." className={`w-full pl-9 pr-4 py-2 rounded-xl border text-sm font-medium focus:outline-none focus:ring-2 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`} value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div>
                                    <div className={`flex rounded-xl border p-1 shrink-0 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>
                                        {['all', 'pending', 'paid'].map(f => <button key={f} onClick={() => setFilter(f)} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${filter === f ? (darkMode ? 'bg-slate-600' : 'bg-slate-100') : 'opacity-40'}`}>{f === 'all' ? 'Todo' : f === 'pending' ? 'Falta' : 'Listo'}</button>)}
                                    </div>
                                    <button onClick={() => setSortOrder(p => p === 'asc' ? 'desc' : (p === 'desc' ? 'default' : 'asc'))} className={`px-3 rounded-xl border flex items-center justify-center ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}><ArrowUpDown size={16} opacity={0.6} /></button>
                                </div>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto p-4">
                            {displayedSavings.length === 0 ? <div className="text-center py-20 opacity-40">Sin resultados</div> : 
                                <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-2 sm:gap-3">
                                    {displayedSavings.map(item => (
                                        <button key={item.id} onClick={() => togglePay(item.id)} className={`relative group flex flex-col items-center justify-center py-3 px-1 rounded-xl border transition-all duration-200 ${item.paid ? 'bg-indigo-600 border-indigo-600 text-white shadow-inner scale-95 opacity-80' : (darkMode ? 'bg-slate-800 border-slate-700 hover:border-indigo-500' : 'bg-white border-slate-200 hover:border-indigo-400 hover:shadow-md hover:-translate-y-1')}`}>
                                            {item.paid && <span className="absolute top-1 right-1 opacity-50"><CheckCircle2 className="w-4 h-4 text-white"/></span>}
                                            <span className={`text-sm md:text-base font-black tracking-tight ${item.paid ? 'text-white' : (darkMode ? 'text-slate-200' : 'text-slate-700')}`}>{formatMoney(item.amount, currency).replace(',00', '')}</span>
                                            <span className="absolute bottom-1 right-2 text-[8px] font-mono font-bold opacity-30">#{item.id}</span>
                                            {!item.paid && item.amount === stats.min && <div className="absolute top-1.5 left-2 w-1.5 h-1.5 bg-green-500 rounded-full"></div>}
                                            {!item.paid && item.amount === stats.max && <div className="absolute top-1.5 left-2 w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></div>}
                                        </button>
                                    ))}
                                </div>
                            }
                        </div>
                        <div className="text-center py-6 text-xs opacity-40 no-print">Desarrollado por <strong>Juan Miguel Rios Redondo</strong></div>
                    </div>
                </div>
            );
        }
        
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
