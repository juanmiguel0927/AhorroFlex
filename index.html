<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahorro Flex - Plan de Ahorro Inteligente</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para traducir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Estilos Personalizados para Impresión y Scrollbars -->
    <style>
        /* Scrollbar personalizado */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Estilos de Impresión */
        @media print {
            body * { visibility: hidden; }
            .printable-area, .printable-area * { visibility: visible; }
            .printable-area { position: absolute; left: 0; top: 0; width: 100%; padding: 20px; }
            .no-print { display: none !important; }
            .print-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; font-size: 10px; font-family: sans-serif; }
            .print-item { border: 1px solid #000; padding: 5px; text-align: center; border-radius: 4px; }
            .print-header { text-align: center; margin-bottom: 20px; font-family: sans-serif; }
            .print-item.paid { background-color: #ddd; text-decoration: line-through; }
        }

        /* Animaciones */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONOS SVG (Componentes simples) ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const PiggyBank = (props) => <Icon {...props} path={<><path d="M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2.5 0-.8.3-2.4-.6-6-.5-.6-1.5-2.5-4.4-2.5z"/><path d="M16 9h.01"/><path d="M7 16h-.01"/></>} />;
        const ArrowUpDown = (props) => <Icon {...props} path={<><path d="m21 16-4 4-4-4"/><path d="M17 20V4"/><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/></>} />;
        const CheckCircle2 = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} />;
        const Search = (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />;
        const Moon = (props) => <Icon {...props} path={<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>} />;
        const Sun = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>} />;
        const Download = (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />;
        const Upload = (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />;
        const TrendingUp = (props) => <Icon {...props} path={<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>} />;
        const TrendingDown = (props) => <Icon {...props} path={<polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>} />;
        const X = (props) => <Icon {...props} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />;
        const Hash = (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></>} />;
        const Printer = (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />;
        const HelpCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></>} />;
        const Trash2 = (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />;
        const Pencil = (props) => <Icon {...props} path={<path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>} />;
        const AlertTriangle = (props) => <Icon {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></>} />;

        // --- UTILIDADES ---
        const EXCHANGE_RATES = { COP: 1, USD: 4100, EUR: 4450 };
        const DEFAULT_MOMENTS = 365;

        const formatMoney = (amount, currency = 'COP') => {
            const value = amount / EXCHANGE_RATES[currency];
            return new Intl.NumberFormat(currency === 'COP' ? 'es-CO' : 'en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: currency === 'COP' ? 0 : 2,
                maximumFractionDigits: currency === 'COP' ? 0 : 2,
            }).format(value);
        };

        const roundTo100 = (num) => Math.round(num / 100) * 100;

        // --- ALGORITMO GENERADOR ---
        const generateDataForTarget = (targetAmount, totalMoments) => {
            const safeTarget = roundTo100(targetAmount || 0);
            const safeMoments = totalMoments || 1;
            
            if (safeTarget <= 0) return [];

            const average = safeTarget / safeMoments;
            
            let minVal = Math.max(100, roundTo100(average * 0.05));
            let maxVal = roundTo100(average * 1.95);

            if (average < 200) { minVal = 100; maxVal = 300; }

            let amounts = [];
            for (let i = 0; i < safeMoments; i++) {
                let val;
                if (minVal >= maxVal) val = minVal;
                else val = Math.floor(Math.random() * ((maxVal - minVal) / 100 + 1)) * 100 + minVal;
                amounts.push(val);
            }

            let currentSum = amounts.reduce((a, b) => a + b, 0);
            let diff = safeTarget - currentSum;
            let safety = 0;
            const maxLoops = safeMoments * 500;

            while (diff !== 0 && safety < maxLoops) {
                const idx = Math.floor(Math.random() * safeMoments);
                const step = 100; 
                if (diff > 0) {
                    if (amounts[idx] + step <= maxVal * 1.5 || average < 200) { 
                        amounts[idx] += step;
                        diff -= step;
                    }
                } else {
                    if (amounts[idx] - step >= minVal) {
                        amounts[idx] -= step;
                        diff += step;
                    }
                }
                safety++;
            }
            
            if (diff !== 0) {
                const maxAmountIdx = amounts.indexOf(Math.max(...amounts));
                if (maxAmountIdx !== -1) {
                    amounts[maxAmountIdx] += diff;
                }
            }

            return amounts
                .map((amount) => ({ amount: amount, paid: false, datePaid: null }))
                .sort(() => Math.random() - 0.5)
                .map((item, index) => ({ ...item, id: index + 1 }));
        };

        // --- COMPONENTE PRINCIPAL ---
        function App() {
            // Estados
            const [targetAmount, setTargetAmount] = useState(0);
            const [totalMoments, setTotalMoments] = useState(DEFAULT_MOMENTS);
            const [savings, setSavings] = useState([]);
            const [isConfigured, setIsConfigured] = useState(false);
            const [amountInput, setAmountInput] = useState('');
            const [momentsInput, setMomentsInput] = useState('365');
            
            // UI
            const [darkMode, setDarkMode] = useState(false);
            const [showHelp, setShowHelp] = useState(false);
            const [filter, setFilter] = useState('all');
            const [sortOrder, setSortOrder] = useState('default');
            const [searchTerm, setSearchTerm] = useState('');
            const [currency, setCurrency] = useState('COP');
            
            const fileInputRef = useRef(null);

            // Carga de datos
            useEffect(() => {
                try {
                    const savedConfig = localStorage.getItem('savings_v4_config');
                    const savedData = localStorage.getItem('savings_v4_data');
                    const savedTheme = localStorage.getItem('savings_v4_theme');

                    if (savedConfig && savedData) {
                        const parsedConfig = JSON.parse(savedConfig);
                        const parsedData = JSON.parse(savedData);
                        
                        if (parsedConfig && parsedConfig.target && Array.isArray(parsedData)) {
                            setTargetAmount(parsedConfig.target);
                            setTotalMoments(parsedConfig.moments || DEFAULT_MOMENTS);
                            setAmountInput(new Intl.NumberFormat('es-CO').format(parsedConfig.target));
                            setMomentsInput(parsedConfig.moments || DEFAULT_MOMENTS);
                            setSavings(parsedData);
                            setIsConfigured(true);
                        }
                    }
                    if (savedTheme === 'dark') setDarkMode(true);
                } catch (error) {
                    console.error("Error cargando datos:", error);
                }
            }, []);

            // Guardado de datos
            useEffect(() => {
                try {
                    if (isConfigured && targetAmount > 0) {
                        localStorage.setItem('savings_v4_config', JSON.stringify({ target: targetAmount, moments: totalMoments }));
                        localStorage.setItem('savings_v4_data', JSON.stringify(savings));
                    }
                    localStorage.setItem('savings_v4_theme', darkMode ? 'dark' : 'light');

                    // Aplicar clase al body
                    if (darkMode) {
                        document.body.classList.add('bg-slate-900', 'text-slate-100');
                        document.body.classList.remove('bg-slate-50', 'text-slate-800');
                        document.documentElement.classList.add('dark');
                    } else {
                        document.body.classList.remove('bg-slate-900', 'text-slate-100');
                        document.body.classList.add('bg-slate-50', 'text-slate-800');
                        document.documentElement.classList.remove('dark');
                    }
                } catch (e) {}
            }, [savings, targetAmount, totalMoments, isConfigured, darkMode]);

            const handleStart = (e) => {
                e.preventDefault();
                let amountStr = String(amountInput).replace(/[^0-9]/g, '');
                let amount = parseInt(amountStr, 10);
                let moments = parseInt(momentsInput, 10);
                
                if (!amount || amount < (moments * 100)) {
                    alert(`Monto insuficiente para ${moments} momentos. Mínimo $100 por casilla.`);
                    return;
                }
                if (!moments || moments < 1 || moments > 5000) {
                    alert("Elige entre 1 y 5000 momentos.");
                    return;
                }
                
                amount = roundTo100(amount);
                
                if (isConfigured) {
                    if (!window.confirm("¡Atención! Al guardar se generará una NUEVA tabla y se borrarán las casillas marcadas. ¿Continuar?")) {
                        return;
                    }
                }

                const newData = generateDataForTarget(amount, moments);
                setTargetAmount(amount);
                setTotalMoments(moments);
                setSavings(newData);
                setIsConfigured(true);
            };

            const handleEditConfig = () => setIsConfigured(false);

            const handleReset = () => {
                if (window.confirm("¿Borrar todo y empezar de cero?")) {
                    setIsConfigured(false);
                    setTargetAmount(0);
                    setAmountInput('');
                    setMomentsInput('365');
                    setSavings([]);
                    localStorage.removeItem('savings_v4_config');
                    localStorage.removeItem('savings_v4_data');
                }
            };

            const togglePay = (id) => {
                setSavings(prev => prev.map(item => {
                    if (item.id === id) {
                        const isPaying = !item.paid;
                        return {
                            ...item,
                            paid: isPaying,
                            datePaid: isPaying ? new Date().toISOString() : null
                        };
                    }
                    return item;
                }));
            };

            const handlePrint = () => window.print();

            const exportData = () => {
                const dataStr = JSON.stringify({ config: { target: targetAmount, moments: totalMoments }, data: savings }, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ahorro_flex_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const json = JSON.parse(event.target.result);
                        if (json.config && json.data) {
                            if (window.confirm("Se reemplazarán los datos actuales. ¿Continuar?")) {
                                setTargetAmount(json.config.target);
                                setTotalMoments(json.config.moments || DEFAULT_MOMENTS);
                                setAmountInput(new Intl.NumberFormat('es-CO').format(json.config.target));
                                setMomentsInput(json.config.moments || DEFAULT_MOMENTS);
                                setSavings(json.data);
                                setIsConfigured(true);
                                alert("¡Carga exitosa!");
                            }
                        }
                    } catch (err) { alert("El archivo no es válido."); }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const totalPaid = useMemo(() => savings.reduce((acc, curr) => curr.paid ? acc + curr.amount : acc, 0), [savings]);
            const percent = targetAmount > 0 ? (totalPaid / targetAmount) * 100 : 0;
            
            const stats = useMemo(() => {
                if (!savings || savings.length === 0) return { min: 0, max: 0 };
                const amounts = savings.map(s => s.amount);
                return { min: Math.min(...amounts), max: Math.max(...amounts) };
            }, [savings]);

            const displayedSavings = useMemo(() => {
                if (!savings) return [];
                let result = [...savings];
                if (searchTerm) result = result.filter(i => i.amount.toString().includes(searchTerm));
                if (filter === 'pending') result = result.filter(i => !i.paid);
                if (filter === 'paid') result = result.filter(i => i.paid);
                
                if (sortOrder === 'asc') result.sort((a, b) => a.amount - b.amount);
                else if (sortOrder === 'desc') result.sort((a, b) => b.amount - a.amount);
                else result.sort((a,b) => a.id - b.id); 
                return result;
            }, [savings, filter, sortOrder, searchTerm]);

            if (!isConfigured) {
                return (
                    <div className={`min-h-screen flex items-center justify-center p-4 font-sans`}>
                        <div className={`relative p-8 rounded-3xl shadow-2xl max-w-md w-full border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-indigo-100'}`}>
                            <button onClick={() => setDarkMode(!darkMode)} className="absolute top-4 right-4 p-2 rounded-full opacity-60 hover:opacity-100">
                                {darkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
                            </button>

                            <div className="flex justify-center mb-6">
                                <div className={`p-5 rounded-full shadow-lg ${darkMode ? 'bg-indigo-900/50' : 'bg-indigo-100'}`}>
                                    <PiggyBank className="w-12 h-12 text-indigo-600" />
                                </div>
                            </div>
                            <h1 className="text-3xl font-black text-center mb-2">Plan de Ahorro</h1>
                            <p className="text-center mb-8 text-sm opacity-60">Personaliza tu meta y duración.</p>

                            <form onSubmit={handleStart} className="space-y-5">
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider mb-2 opacity-60 ml-1">Monto Total</label>
                                    <div className="relative">
                                        <span className="absolute left-4 top-1/2 -translate-y-1/2 font-bold text-lg opacity-50">$</span>
                                        <input
                                            type="text" required value={amountInput}
                                            onChange={(e) => {
                                                const val = e.target.value.replace(/[^0-9]/g, '');
                                                setAmountInput(new Intl.NumberFormat('es-CO').format(val));
                                            }}
                                            placeholder="Ej: 5.000.000"
                                            className={`w-full pl-10 pr-4 py-3 border rounded-xl font-bold text-xl focus:outline-none focus:ring-2 transition-all ${darkMode ? 'bg-slate-900 border-slate-600' : 'bg-slate-50 border-slate-200'}`}
                                        />
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold uppercase tracking-wider mb-2 opacity-60 ml-1">Número de Momentos (Pasos)</label>
                                    <div className="relative">
                                        <Hash className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 opacity-50" />
                                        <input
                                            type="number" required min="1" max="5000" value={momentsInput}
                                            onChange={(e) => setMomentsInput(e.target.value)}
                                            placeholder="365"
                                            className={`w-full pl-10 pr-4 py-3 border rounded-xl font-bold text-xl focus:outline-none focus:ring-2 transition-all ${darkMode ? 'bg-slate-900 border-slate-600' : 'bg-slate-50 border-slate-200'}`}
                                        />
                                    </div>
                                </div>
                                
                                {savings && savings.length > 0 && (
                                    <div className="flex items-center gap-2 text-xs text-yellow-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                                        <AlertTriangle className="w-4 h-4 shrink-0" />
                                        <span>Importante: Se reiniciará el progreso al guardar.</span>
                                    </div>
                                )}

                                <div className="flex gap-3 pt-4">
                                    <button type="submit" className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition-transform active:scale-95">
                                        {savings && savings.length > 0 ? 'Actualizar Plan' : 'Crear Plan'}
                                    </button>
                                    <button type="button" onClick={() => fileInputRef.current.click()} className="px-4 rounded-xl border flex items-center justify-center hover:bg-opacity-10 hover:bg-black" title="Importar Backup"><Upload className="w-6 h-6 opacity-60" /></button>
                                </div>
                            </form>
                            <input type="file" ref={fileInputRef} onChange={importData} accept=".json" className="hidden" />
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen font-sans pb-24`}>
                    
                    {/* MODAL AYUDA */}
                    {showHelp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in">
                            <div className={`relative max-w-lg w-full p-6 rounded-2xl shadow-2xl ${darkMode ? 'bg-slate-800 border border-slate-700' : 'bg-white'}`}>
                                <button onClick={() => setShowHelp(false)} className="absolute top-4 right-4 opacity-50 hover:opacity-100"><X className="w-6 h-6" /></button>
                                <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><HelpCircle className="w-6 h-6 text-indigo-500" /> Ayuda</h2>
                                <div className="space-y-4 text-sm opacity-80">
                                    <p>Tu meta de <strong>{formatMoney(targetAmount)}</strong> se divide en <strong>{totalMoments} momentos</strong> diferentes.</p>
                                    
                                    <div className={`p-4 rounded-xl border ${darkMode ? 'bg-slate-700 border-slate-600' : 'bg-slate-100 border-slate-200'}`}>
                                        <p className="font-bold mb-2">Valores en tu tabla:</p>
                                        <ul className="space-y-1 list-disc list-inside">
                                            <li><span className="text-green-500 font-bold">Mínimo (Días Fáciles):</span> {formatMoney(stats.min)}</li>
                                            <li><span className="text-red-500 font-bold">Máximo (Días Reto):</span> {formatMoney(stats.max)}</li>
                                        </ul>
                                    </div>

                                    <p><strong>Instrucciones:</strong></p>
                                    <ul className="list-decimal list-inside space-y-1">
                                        <li>Elige una casilla según tu presupuesto del día.</li>
                                        <li>Deposita el dinero real en tu alcancía.</li>
                                        <li>Marca la casilla en la app.</li>
                                        <li>¡Repite hasta completar el 100%!</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ÁREA IMPRIMIBLE */}
                    <div className="printable-area hidden">
                        <div className="print-header">
                            <h1>Plan de Ahorro: {formatMoney(targetAmount)}</h1>
                            <p>Meta: {totalMoments} pasos | Min: {formatMoney(stats.min)} | Max: {formatMoney(stats.max)}</p>
                        </div>
                        <div className="print-grid">
                            {savings.map(s => (
                                <div key={s.id} className={`print-item ${s.paid ? 'paid' : ''}`}>
                                    #{s.id} <br/> <strong>{formatMoney(s.amount)}</strong>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* UI PRINCIPAL */}
                    <div className="no-print">
                        <div className={`sticky top-0 z-30 backdrop-blur-md border-b transition-colors ${darkMode ? 'bg-slate-900/90 border-slate-800' : 'bg-white/90 border-slate-200'}`}>
                            <div className="max-w-7xl mx-auto px-4 py-3">
                                <div className="flex flex-wrap justify-between items-center mb-4 gap-3">
                                    <h1 className="text-lg font-bold flex items-center gap-2">
                                        <div className={`p-1.5 rounded-lg ${darkMode ? 'bg-indigo-900/50' : 'bg-indigo-50'}`}><PiggyBank className="w-5 h-5 text-indigo-500" /></div>
                                        <span>Ahorro Flex</span>
                                    </h1>
                                    <div className="flex items-center gap-2">
                                        <div className={`flex items-center gap-1 p-1 rounded-xl border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>
                                            <button onClick={handleEditConfig} className="p-2 opacity-60 hover:opacity-100 hover:text-indigo-500" title="Modificar Configuración"><Pencil className="w-4 h-4" /></button>
                                            <button onClick={handleReset} className="p-2 opacity-60 hover:opacity-100 hover:text-red-500" title="Borrar Todo"><Trash2 className="w-4 h-4" /></button>
                                            <div className="w-px h-4 bg-current opacity-20"></div>
                                            <button onClick={() => setShowHelp(true)} className="p-2 opacity-60 hover:opacity-100" title="Ayuda"><HelpCircle className="w-4 h-4" /></button>
                                            <button onClick={handlePrint} className="p-2 opacity-60 hover:opacity-100" title="Imprimir PDF"><Printer className="w-4 h-4" /></button>
                                            <button onClick={exportData} className="p-2 opacity-60 hover:opacity-100" title="Exportar"><Download className="w-4 h-4" /></button>
                                            <button onClick={() => setDarkMode(!darkMode)} className="p-2 opacity-60 hover:opacity-100">{darkMode ? <Sun className="w-4 h-4" /> : <Moon className="w-4 h-4" />}</button>
                                        </div>
                                    </div>
                                </div>

                                <div className={`rounded-2xl p-5 border mb-4 shadow-sm relative overflow-hidden ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>
                                    <div className="relative z-10">
                                        <div className="flex justify-between items-end mb-2">
                                            <div>
                                                <p className="text-[10px] opacity-50 uppercase font-bold tracking-wider mb-1">Ahorrado</p>
                                                <div className="flex items-baseline gap-2">
                                                    <p className="text-2xl md:text-3xl font-black leading-none tracking-tight">{formatMoney(totalPaid, currency)}</p>
                                                    <span className="text-xs opacity-50 font-medium">/ {formatMoney(targetAmount, currency)}</span>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-indigo-500 font-bold text-xl md:text-2xl">{percent.toFixed(1)}%</p>
                                            </div>
                                        </div>
                                        <div className={`w-full rounded-full h-2.5 overflow-hidden mb-3 ${darkMode ? 'bg-slate-900' : 'bg-slate-100'}`}>
                                            <div className="bg-gradient-to-r from-pink-500 to-indigo-600 h-2.5 rounded-full transition-all duration-700" style={{ width: `${percent}%` }}></div>
                                        </div>
                                        <div className="flex gap-4 text-xs pt-2 border-t border-dashed border-gray-500/20">
                                            <div className="flex items-center gap-1 opacity-70"><TrendingDown className="w-3 h-3 text-green-500"/> Min: <b>{formatMoney(stats.min, currency)}</b></div>
                                            <div className="flex items-center gap-1 opacity-70"><TrendingUp className="w-3 h-3 text-red-500"/> Max: <b>{formatMoney(stats.max, currency)}</b></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex flex-col sm:flex-row gap-3">
                                    <div className="relative flex-grow">
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-30"><Search className="w-4 h-4"/></span>
                                        <input 
                                            type="number" placeholder="Buscar monto..." 
                                            className={`w-full pl-9 pr-4 py-2 rounded-xl border text-sm font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}
                                            value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    <div className="flex gap-2 shrink-0">
                                        <div className={`flex rounded-xl border p-1 ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'}`}>
                                            {['all', 'pending', 'paid'].map(f => (
                                                <button key={f} onClick={() => setFilter(f)} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${filter === f ? (darkMode ? 'bg-slate-600 text-white' : 'bg-slate-100 text-slate-800') : 'opacity-40 hover:opacity-100'}`}>
                                                    {f === 'all' ? 'Todo' : f === 'pending' ? 'Falta' : 'Listo'}
                                                </button>
                                            ))}
                                        </div>
                                        <button onClick={() => setSortOrder(prev => prev === 'asc' ? 'desc' : (prev === 'desc' ? 'default' : 'asc'))} className={`px-3 rounded-xl border flex items-center justify-center ${darkMode ? 'bg-slate-800 border-slate-700 hover:bg-slate-700' : 'bg-white border-slate-200 hover:bg-slate-50'}`}>
                                            <ArrowUpDown className="w-4 h-4 opacity-60" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto p-4">
                            {displayedSavings.length === 0 ? (
                                <div className="text-center py-20 opacity-40"><p>Sin resultados.</p></div>
                            ) : (
                                <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-2 sm:gap-3">
                                {displayedSavings.map((item) => (
                                    <button
                                    key={item.id}
                                    onClick={() => togglePay(item.id)}
                                    className={`
                                        relative group flex flex-col items-center justify-center py-3 px-1 rounded-xl border transition-all duration-200
                                        ${item.paid 
                                        ? 'bg-indigo-600 border-indigo-600 text-white shadow-inner scale-95 opacity-80' 
                                        : (darkMode ? 'bg-slate-800 border-slate-700 hover:border-indigo-500' : 'bg-white border-slate-200 hover:border-indigo-400 hover:shadow-md hover:-translate-y-1')}
                                    `}
                                    >
                                    {item.paid && <span className="absolute top-1 right-1 opacity-50"><CheckCircle2 className="w-4 h-4 text-white"/></span>}
                                    <span className={`text-sm md:text-base font-black tracking-tight ${item.paid ? 'text-white' : (darkMode ? 'text-slate-200' : 'text-slate-700')}`}>
                                        {formatMoney(item.amount, currency).replace(',00', '')}
                                    </span>
                                    <span className="absolute bottom-1 right-2 text-[8px] font-mono font-bold opacity-30">#{item.id}</span>
                                    {!item.paid && item.amount === stats.min && <div className="absolute top-1.5 left-2 w-1.5 h-1.5 bg-green-500 rounded-full" title="Mínimo"></div>}
                                    {!item.paid && item.amount === stats.max && <div className="absolute top-1.5 left-2 w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse" title="Máximo"></div>}
                                    </button>
                                ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
